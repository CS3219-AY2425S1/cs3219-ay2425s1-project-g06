FROM node:20 AS build

WORKDIR /app

COPY package*.json .

RUN npm install

COPY ./src ./src
COPY ./public ./public
COPY tsconfig.json .

ARG GENERATE_SOURCEMAP=false
# default arguments for connecting to services, can be overridden by docker-compose
ARG REACT_APP_USER_SERVICE_URL=http://localhost:3001/
ARG REACT_APP_QUESTION_SERVICE_URL=http://localhost:3002/
ARG REACT_APP_MATCHING_SERVICE_URL=http://localhost:3003
ARG REACT_APP_COMMUNICATION_SERVICE_URL=http://localhost:3004
ARG REACT_APP_COLLABORATION_SERVICE_URL=http://localhost:3005
ARG REACT_APP_AI_HINT_URL=http://localhost:3006
ARG REACT_APP_VIDEO_SERVICE_PORT=9000

ENV REACT_APP_USER_SERVICE_URL=$REACT_APP_USER_SERVICE_URL
ENV REACT_APP_QUESTION_SERVICE_URL=$REACT_APP_QUESTION_SERVICE_URL
ENV REACT_APP_MATCHING_SERVICE_URL=$REACT_APP_MATCHING_SERVICE_URL
ENV REACT_APP_COMMUNICATION_SERVICE_URL=$REACT_APP_COMMUNICATION_SERVICE_URL
ENV REACT_APP_COLLABORATION_SERVICE_URL=$REACT_APP_COLLABORATION_SERVICE_URL
ENV REACT_APP_AI_HINT_URL=$REACT_APP_AI_HINT_URL
ENV REACT_APP_VIDEO_SERVICE_PORT=$REACT_APP_VIDEO_SERVICE_PORT


RUN npm run build

FROM nginx:latest
COPY ./nginx /etc/nginx
COPY --from=build /app/build /app
