FROM node:20 AS build

WORKDIR /app

COPY package*.json .

RUN npm install

COPY ./src ./src
COPY ./public ./public
COPY tsconfig.json .

ARG GENERATE_SOURCEMAP=false
ARG REACT_APP_USER_SERVICE_URL
ARG REACT_APP_QUESTION_SERVICE_URL
ARG REACT_APP_MATCHING_SERVICE_URL
ARG REACT_APP_COMMUNICATION_SERVICE_URL
ARG REACT_APP_COLLABORATION_SERVICE_URL
ARG REACT_APP_VIDEO_SERVICE_PORT

ENV REACT_APP_USER_SERVICE_URL=$REACT_APP_USER_SERVICE_URL
ENV REACT_APP_QUESTION_SERVICE_URL=$REACT_APP_QUESTION_SERVICE_URL
ENV REACT_APP_MATCHING_SERVICE_URL=$REACT_APP_MATCHING_SERVICE_URL
ENV REACT_APP_COMMUNICATION_SERVICE_URL=$REACT_APP_COMMUNICATION_SERVICE_URL
ENV REACT_APP_COLLABORATION_SERVICE_URL=$REACT_APP_COLLABORATION_SERVICE_URL
ENV REACT_APP_VIDEO_SERVICE_PORT=$REACT_APP_VIDEO_SERVICE_PORT


RUN npm run build

FROM nginx:latest
COPY ./nginx /etc/nginx
COPY --from=build /app/build /app
